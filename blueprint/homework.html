<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>마비노기 - 퀘스트 및 숙제 관리</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #111827;
            color: #d1d5db;
        }
        .sidebar-link.active {
            background-color: #4f46e5;
            color: #ffffff;
            font-weight: 700;
        }
        .tab-button.active {
            background-color: #4338ca;
            color: #ffffff;
        }
        .task-item input[type="checkbox"]:checked + label {
            text-decoration: line-through;
            color: #6b7280;
        }
        .task-item input[type="checkbox"]:checked + label .task-text {
             opacity: 0.6;
        }
        .custom-checkbox {
            width: 1.25rem;
            height: 1.25rem;
            border: 2px solid #4b5563;
            border-radius: 0.25rem;
            display: inline-block;
            vertical-align: middle;
            margin-right: 0.75rem;
            flex-shrink: 0;
            transition: background-color 0.2s;
        }
        .task-item input[type="checkbox"]:checked + label .custom-checkbox {
            background-color: #4f46e5;
            border-color: #4f46e5;
            background-image: url("data:image/svg+xml,%3csvg viewBox='0 0 16 16' fill='white' xmlns='http://www.w3.org/2000/svg'%3e%3cpath d='M12.207 4.793a1 1 0 010 1.414l-5 5a1 1 0 01-1.414 0l-2-2a1 1 0 011.414-1.414L6.5 9.086l4.293-4.293a1 1 0 011.414 0z'/%3e%3c/svg%3e");
        }
    </style>
</head>
<body class="text-gray-800">

    <div class="relative min-h-screen flex">
        <!-- 사이드바 네비게이션 -->
        <aside id="sidebar" class="w-64 bg-gray-900 text-white shadow-lg h-screen fixed top-0 left-0 transform transition-transform duration-300 ease-in-out z-30">
            <div class="p-5 border-b border-gray-700 flex items-center space-x-3">
                 <div class="w-10 h-10 rounded-lg bg-indigo-600 flex items-center justify-center">
                    <svg class="w-6 h-6 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25" /></svg>
                 </div>
                 <div>
                    <h2 class="text-lg font-bold">마비노기</h2>
                    <p class="text-xs text-gray-400">제작 계산기</p>
                 </div>
            </div>
            <nav class="mt-4">
                <ul>
                    <li><a href="#" class="sidebar-link flex items-center py-3 px-5 text-gray-300 hover:bg-gray-800 transition-colors">
                        <svg class="w-6 h-6 mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M21 7.5l-9-5.25L3 7.5m18 0l-9 5.25m9-5.25v9l-9 5.25M3 7.5l9 5.25M3 7.5v9l9 5.25m0-9v9" /></svg>
                        아이템
                    </a></li>
                    <li><a href="#" class="sidebar-link active flex items-center py-3 px-5">
                        <svg class="w-6 h-6 mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12h.01M15 12h.01M10.5 16.5h3m-6.38-3.386l-1.591-1.592a2.25 2.25 0 010-3.182l1.591-1.592L9 6.5l1.518-1.518a2.25 2.25 0 013.182 0l1.592 1.591L15 9.5l-1.518 1.518a2.25 2.25 0 01-3.182 0L9 12.5l-1.88-1.88z" /></svg>
                        퀘스트
                    </a></li>
                    <li><a href="mabinogi-lifeskill-management.html" class="sidebar-link flex items-center py-3 px-5 text-gray-300 hover:bg-gray-800 transition-colors">
                        <svg class="w-6 h-6 mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M11.48 3.499a.562.562 0 011.04 0l2.125 5.111a.563.563 0 00.475.31h5.418a.562.562 0 01.321.988l-4.204 3.055a.563.563 0 00-.182.557l1.528 4.97a.562.562 0 01-.82.622l-4.42-3.232a.563.563 0 00-.664 0l-4.42 3.232a.562.562 0 01-.82-.622l1.528-4.97a.563.563 0 00-.182-.557l-4.204-3.055a.562.562 0 01.321-.988h5.418a.563.563 0 00.475-.31L11.48 3.5z" /></svg>
                        생활스킬
                    </a></li>
                    <li><a href="/character-management.html" class="sidebar-link flex items-center py-3 px-5 text-gray-300 hover:bg-gray-800 transition-colors">
                        <svg class="w-6 h-6 mr-3" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" /></svg>
                        캐릭터 관리
                    </a></li>
                </ul>
            </nav>
        </aside>

        <!-- 메인 콘텐츠 -->
        <main id="main-content" class="flex-1 transition-all duration-300 ease-in-out">
            <header class="bg-gray-900 shadow-sm p-4 flex items-center sticky top-0 z-20">
                <button id="sidebar-toggle-btn" class="p-2 mr-4 text-gray-400 hover:text-white">
                    <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" /></svg>
                </button>
                <div class="text-sm text-gray-400"><span>홈</span><span class="mx-1">/</span><span id="breadcrumb">숙제 체크리스트</span></div>
            </header>
            
            <div id="content-wrapper" class="p-4 md:p-8">
                <!-- 탭 메뉴 -->
                <div class="mb-6 border-b border-gray-700">
                    <nav class="flex space-x-1" aria-label="Tabs">
                        <button id="tab-daily" class="tab-button active font-semibold px-4 py-2 rounded-t-md">일일 숙제</button>
                        <button id="tab-weekly" class="tab-button text-gray-400 font-semibold px-4 py-2 rounded-t-md">주간 숙제</button>
                    </nav>
                </div>

                <!-- 탭 콘텐츠 -->
                <div id="tab-content-daily"></div>
                <div id="tab-content-weekly" class="hidden"></div>
            </div>
        </main>
    </div>

    <div id="sidebar-overlay" class="fixed inset-0 bg-black bg-opacity-60 z-20 hidden"></div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const dailyTasks = {
                '캐시샵 관련': [
                    { id: 'd1', text: '추천픽 무료 상품 1개 구입', completed: false },
                    { id: 'd2', text: '아이템샵(데카)에서 일일 은동전 상자 1개 구입', completed: false },
                    { id: 'd3', text: '아이템샵(골드)에서 조각난 보석 보물상자 10개 구입', completed: false },
                ],
                '던전/사냥터': [
                    { id: 'd4', text: '검은 구멍 3회 돌기 (일반/심층 선택)', completed: false },
                    { id: 'd5', text: '소환의 결계 2~4회 참여 (최대 상자 4개 획득)', completed: false },
                    { id: 'd6', text: '망령의 탑 5회 클리어', completed: false },
                    { id: 'd7', text: '요일 던전 1회 클리어 (요일별 보상 상이)', completed: false },
                    { id: 'd8', text: '늑대의 숲, 여신의 뜰, 얼음 협곡 보스 각 난이도별 1회씩 (일반/어려움/매우 어려움)', completed: false },
                ],
                '미션/기타': [
                    { id: 'd9', text: '일일 미션 수행 및 보상 수령 (정령의 날개, 룬의 파편 등)', completed: false },
                    { id: 'd10', text: '생활 콘텐츠: 요리, 채집 등 재료 수급', completed: false },
                    { id: 'd11', text: '경매장 시세 확인, 아이템 매입/판매', completed: false },
                    { id: 'd12', text: '정예 몬스터 처치', completed: false },
                    { id: 'd13', text: '출석 체크', completed: false },
                ]
            };
            const weeklyTasks = {
                '필드/레이드/어비스': [
                    { id: 'w1', text: '필드보스: 페리, 크라브바흐, 크라마 처치', completed: false },
                    { id: 'w2', text: '어비스: 가라앉은 유적, 무너진 제단, 파멸의 전당 클리어', completed: false },
                    { id: 'w3', text: '레이드: 먼 바다의 회색 미로 클리어', completed: false },
                    { id: 'w4', text: '주간 어비스 보상 3회 획득 (가능한 최고 난이도 추천)', completed: false },
                ],
                '미션/교환': [
                    { id: 'w5', text: '마물 퇴치 증표 교환 (아득한 별의 인장, 강화 재연소 촉매 필수 구매)', completed: false },
                    { id: 'w6', text: '모험가 길드 정기 의뢰: 심층 던전 3회, 던전 5회, 사냥터 5회 클리어', completed: false },
                    { id: 'w7', text: '임무 게시판 채집 스크롤 3종 3회 반복 (티르코네일, 던바튼, 콜헨)', completed: false },
                    { id: 'w8', text: '주간 미션 수행 및 보상 수령 (데카, 연금술 촉매 등)', completed: false },
                ],
                 '기타': [
                    { id: 'w9', text: '마족 공물 상장 구입 (1500 데카)', completed: false },
                    { id: 'w10', text: '각 마을 자파상점/식료품점에서 요리 재료(설탕, 레몬, 후추 등) 주간 한정 수량 구입', completed: false },
                    { id: 'w11', text: '여관에서 하트 물품(팬 먹이 등) 주간 초기화 후 구입', completed: false },
                ]
            };

            const contentDaily = document.getElementById('tab-content-daily');
            const contentWeekly = document.getElementById('tab-content-weekly');
            const tabDaily = document.getElementById('tab-daily');
            const tabWeekly = document.getElementById('tab-weekly');
            
            function loadState() {
                const dailyState = JSON.parse(localStorage.getItem('dailyTasksState')) || {};
                const weeklyState = JSON.parse(localStorage.getItem('weeklyTasksState')) || {};
                Object.values(dailyTasks).flat().forEach(task => task.completed = !!dailyState[task.id]);
                Object.values(weeklyTasks).flat().forEach(task => task.completed = !!weeklyState[task.id]);
            }
            
            function saveState(type) {
                const state = {};
                const source = type === 'daily' ? dailyTasks : weeklyTasks;
                Object.values(source).flat().forEach(task => state[task.id] = task.completed);
                localStorage.setItem(`${type}TasksState`, JSON.stringify(state));
            }
            
            function createTaskElement(task, type) {
                const li = document.createElement('li');
                li.className = 'task-item bg-gray-800 p-4 rounded-lg flex items-center';
                li.innerHTML = `
                    <input type="checkbox" id="${task.id}" class="hidden" ${task.completed ? 'checked' : ''}>
                    <label for="${task.id}" class="flex items-center cursor-pointer w-full">
                        <span class="custom-checkbox"></span>
                        <span class="task-text text-gray-300">${task.text}</span>
                    </label>
                `;
                li.querySelector('input').addEventListener('change', (e) => {
                    task.completed = e.target.checked;
                    saveState(type);
                    updateProgress(type);
                });
                return li;
            }

            function renderTasks(container, tasks, type, title, timerId) {
                const totalTasks = Object.values(tasks).flat().length;
                let completedTasks = Object.values(tasks).flat().filter(t => t.completed).length;

                container.innerHTML = `
                    <div class="mb-6 bg-gray-800 rounded-lg p-4">
                        <div class="flex justify-between items-center mb-2">
                            <span class="font-semibold text-white">${title} 초기화까지</span>
                            <span id="${timerId}" class="font-mono text-lg text-green-400"></span>
                        </div>
                        <div class="w-full bg-gray-700 rounded-full h-2.5">
                            <div id="${type}-progress" class="bg-indigo-600 h-2.5 rounded-full" style="width: ${totalTasks > 0 ? (completedTasks / totalTasks * 100) : 0}%"></div>
                        </div>
                    </div>
                    ${Object.entries(tasks).map(([category, taskList]) => `
                        <div class="mb-8">
                            <h3 class="text-xl font-bold text-white mb-4 border-l-4 border-indigo-500 pl-3">${category}</h3>
                            <ul class="space-y-3">
                                ${taskList.map(task => createTaskElement(task, type).outerHTML).join('')}
                            </ul>
                        </div>
                    `).join('')}
                `;
            }

            function updateProgress(type) {
                const source = type === 'daily' ? dailyTasks : weeklyTasks;
                const totalTasks = Object.values(source).flat().length;
                const completedTasks = Object.values(source).flat().filter(t => t.completed).length;
                const progressBar = document.getElementById(`${type}-progress`);
                if(progressBar) progressBar.style.width = `${totalTasks > 0 ? (completedTasks / totalTasks * 100) : 0}%`;
            }
            
            function updateCountdowns() {
                const now = new Date();
                
                // Daily reset
                const tomorrow = new Date(now);
                tomorrow.setDate(now.getDate() + 1);
                tomorrow.setHours(6, 0, 0, 0);
                if (now.getHours() < 6) { tomorrow.setDate(now.getDate()); }
                const dailyDiff = tomorrow - now;
                document.getElementById('daily-timer').textContent = formatTime(dailyDiff);

                // Weekly reset
                const nextMonday = new Date(now);
                nextMonday.setDate(now.getDate() + (1 + 7 - now.getDay()) % 7);
                if (now.getDay() === 1 && now.getHours() < 6) {} // It's currently Monday before reset
                else if (now.getDay() === 0) { nextMonday.setDate(now.getDate() + 1)} // Sunday
                else if (now.getDay() !== 1) {}
                else { nextMonday.setDate(now.getDate() + 7); } // It's past reset time on Monday
                nextMonday.setHours(6, 0, 0, 0);

                const weeklyDiff = nextMonday - now;
                document.getElementById('weekly-timer').textContent = formatTime(weeklyDiff);
            }

            function formatTime(ms) {
                let seconds = Math.floor(ms / 1000);
                let minutes = Math.floor(seconds / 60);
                let hours = Math.floor(minutes / 60);
                const days = Math.floor(hours / 24);
                seconds %= 60; minutes %= 60; hours %= 24;
                return `${days > 0 ? days + '일 ' : ''}${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            }

            function switchTab(tabName) {
                if(tabName === 'daily') {
                    tabDaily.classList.add('active');
                    tabWeekly.classList.remove('active');
                    contentDaily.classList.remove('hidden');
                    contentWeekly.classList.add('hidden');
                } else {
                    tabWeekly.classList.add('active');
                    tabDaily.classList.remove('active');
                    contentWeekly.classList.remove('hidden');
                    contentDaily.classList.add('hidden');
                }
            }
            
            // --- 초기화 ---
            loadState();
            renderTasks(contentDaily, dailyTasks, 'daily', '일일', 'daily-timer');
            renderTasks(contentWeekly, weeklyTasks, 'weekly', '주간', 'weekly-timer');
            
            tabDaily.addEventListener('click', () => switchTab('daily'));
            tabWeekly.addEventListener('click', () => switchTab('weekly'));

            updateCountdowns();
            setInterval(updateCountdowns, 1000);
            
            const sidebar = document.getElementById('sidebar'), mainContent = document.getElementById('main-content'),
                  sidebarToggleBtn = document.getElementById('sidebar-toggle-btn'), sidebarOverlay = document.getElementById('sidebar-overlay');
            function applySidebarState(isOpen) {
                 const isDesktop = window.innerWidth >= 768;
                 if (isOpen) { sidebar.classList.remove('-translate-x-full'); sidebarOverlay.classList.remove('hidden'); if (isDesktop) { mainContent.classList.add('md:ml-64'); sidebarOverlay.classList.add('hidden'); } } 
                 else { sidebar.classList.add('-translate-x-full'); sidebarOverlay.classList.add('hidden'); if (isDesktop) { mainContent.classList.remove('md:ml-64'); } }
            }
            function toggleSidebar() { applySidebarState(!sidebar.classList.contains('-translate-x-full')); }
            function initializeSidebar() { applySidebarState(window.innerWidth >= 768); }
            sidebarToggleBtn.addEventListener('click', toggleSidebar);
            sidebarOverlay.addEventListener('click', toggleSidebar);
            window.addEventListener('resize', initializeSidebar);
            initializeSidebar();
        });
    </script>
</body>
</html>
