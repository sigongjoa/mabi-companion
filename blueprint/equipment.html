<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>마비노기 - 캐릭터 장비 관리</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #111827;
            color: #d1d5db;
        }
        .sidebar-link.active {
            background-color: #4f46e5;
            color: #ffffff;
            font-weight: 700;
        }
        .equipment-slot {
            width: 72px;
            height: 72px;
            background-color: rgba(17, 24, 39, 0.8);
            border: 2px dashed #4b5563;
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s, border-color 0.2s;
        }
        .equipment-slot.drag-over {
            background-color: #374151;
            border-color: #6366f1;
        }
        .equipment-slot img {
            max-width: 100%;
            max-height: 100%;
            pointer-events: none; /* Make images non-interactive for drop events */
        }
        .inventory-item {
            width: 72px;
            height: 72px;
            background-color: #1f2937;
            border: 2px solid #4b5563;
            border-radius: 0.5rem;
            position: relative;
            cursor: grab;
        }
        .inventory-item.non-equip {
            cursor: default;
        }
        .inventory-item.selected {
            border-color: #818cf8;
            box-shadow: 0 0 10px #818cf8;
        }
        .inventory-item.equipped {
            opacity: 0.4;
        }
    </style>
</head>
<body class="text-gray-800">

    <div class="relative min-h-screen flex">
        <!-- 사이드바 네비게이션 -->
        <aside id="sidebar" class="w-64 bg-gray-900 text-white shadow-lg h-screen fixed top-0 left-0 transform transition-transform duration-300 ease-in-out z-30">
            <div class="p-5 border-b border-gray-700 flex items-center space-x-3">
                 <div class="w-10 h-10 rounded-lg bg-indigo-600 flex items-center justify-center">
                    <svg class="w-6 h-6 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25" /></svg>
                 </div>
                 <div>
                    <h2 class="text-lg font-bold">마비노기</h2>
                    <p class="text-xs text-gray-400">제작 계산기</p>
                 </div>
            </div>
            <nav class="mt-4">
                <ul>
                    <li><a href="#" class="sidebar-link flex items-center py-3 px-5 text-gray-300 hover:bg-gray-800 transition-colors">
                        <svg class="w-6 h-6 mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M21 7.5l-9-5.25L3 7.5m18 0l-9 5.25m9-5.25v9l-9 5.25M3 7.5l9 5.25M3 7.5v9l9 5.25m0-9v9" /></svg>
                        아이템
                    </a></li>
                    <li><a href="#" class="sidebar-link flex items-center py-3 px-5 text-gray-300 hover:bg-gray-800 transition-colors">
                        <svg class="w-6 h-6 mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12h.01M15 12h.01M10.5 16.5h3m-6.38-3.386l-1.591-1.592a2.25 2.25 0 010-3.182l1.591-1.592L9 6.5l1.518-1.518a2.25 2.25 0 013.182 0l1.592 1.591L15 9.5l-1.518 1.518a2.25 2.25 0 01-3.182 0L9 12.5l-1.88-1.88z" /></svg>
                        퀘스트
                    </a></li>
                    <li><a href="#" class="sidebar-link flex items-center py-3 px-5 text-gray-300 hover:bg-gray-800 transition-colors">
                        <svg class="w-6 h-6 mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M11.48 3.499a.562.562 0 011.04 0l2.125 5.111a.563.563 0 00.475.31h5.418a.562.562 0 01.321.988l-4.204 3.055a.563.563 0 00-.182.557l1.528 4.97a.562.562 0 01-.82.622l-4.42-3.232a.563.563 0 00-.664 0l-4.42 3.232a.562.562 0 01-.82-.622l1.528-4.97a.563.563 0 00-.182-.557l-4.204-3.055a.562.562 0 01.321-.988h5.418a.563.563 0 00.475-.31L11.48 3.5z" /></svg>
                        생활스킬
                    </a></li>
                    <li><a href="#" class="sidebar-link active flex items-center py-3 px-5">
                        <svg class="w-6 h-6 mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75m-3-7.036A11.959 11.959 0 013.598 6 11.99 11.99 0 003 9.749c0 5.592 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.571-.598-3.751h-.152c-3.196 0-6.1-1.248-8.25-3.286zm0 13.036h.008v.016h-.008v-.016z" /></svg>
                        캐릭터 장비
                    </a></li>
                     <li><a href="/character-management.html" class="sidebar-link flex items-center py-3 px-5 text-gray-300 hover:bg-gray-800 transition-colors">
                        <svg class="w-6 h-6 mr-3" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" /></svg>
                        캐릭터 관리
                    </a></li>
                </ul>
            </nav>
        </aside>

        <!-- 메인 콘텐츠 -->
        <main id="main-content" class="flex-1 transition-all duration-300 ease-in-out">
            <header class="bg-gray-900 shadow-sm p-4 flex items-center sticky top-0 z-20">
                <button id="sidebar-toggle-btn" class="p-2 mr-4 text-gray-400 hover:text-white">
                    <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" /></svg>
                </button>
                <div class="text-sm text-gray-400"><span>홈</span><span class="mx-1">/</span><span>캐릭터 장비</span></div>
            </header>
            
            <div id="equipment-container" class="p-4 md:p-8 flex flex-col items-center justify-center h-[calc(100vh-64px)] overflow-hidden">
                 <!-- 장비창 -->
                <div class="relative w-full max-w-4xl mx-auto flex justify-center items-center">
                    <!-- 왼쪽 장비 슬롯 -->
                    <div class="space-y-4">
                        <div class="equipment-slot" data-slot="weapon"></div>
                        <div class="equipment-slot" data-slot="belt"></div>
                        <div class="equipment-slot" data-slot="ring1"></div>
                        <div class="equipment-slot" data-slot="ring2"></div>
                        <div class="equipment-slot" data-slot="pet"></div>
                    </div>

                    <!-- 캐릭터 미리보기 -->
                    <div class="mx-8 text-center relative">
                         <img src="https://placehold.co/200x400/1f2937/9ca3af?text=Character" alt="캐릭터" class="h-[400px]">
                         <h2 class="text-2xl font-bold mt-4 text-white">SessionLocal</h2>
                         <p class="text-gray-400">Lv.28 견습 힐러</p>
                         <!-- 퀵슬롯 -->
                         <div class="absolute bottom-[-20px] left-1/2 -translate-x-1/2 flex space-x-2">
                             <div class="inventory-item non-equip flex items-center justify-center"><img src="https://placehold.co/64x64/ef4444/fee2e2?text=HP"></div>
                             <div class="inventory-item non-equip flex items-center justify-center"></div>
                             <div class="inventory-item non-equip flex items-center justify-center"></div>
                             <div class="inventory-item non-equip flex items-center justify-center"></div>
                             <div class="inventory-item non-equip flex items-center justify-center"><img src="https://placehold.co/64x64/22c55e/dcfce7?text=F"></div>
                         </div>
                    </div>

                    <!-- 오른쪽 장비 슬롯 -->
                    <div class="space-y-4">
                        <div class="equipment-slot" data-slot="shield"></div>
                        <div class="equipment-slot" data-slot="armor"></div>
                        <div class="equipment-slot" data-slot="gloves"></div>
                        <div class="equipment-slot" data-slot="pants"></div>
                        <div class="equipment-slot" data-slot="boots"></div>
                    </div>
                </div>

                <!-- 인벤토리 -->
                <div class="mt-16 w-full max-w-5xl">
                    <h3 class="text-xl font-semibold text-white mb-4 text-center">인벤토리</h3>
                    <div id="inventory-grid" class="p-4 bg-gray-900/50 rounded-lg grid grid-cols-5 sm:grid-cols-8 md:grid-cols-10 gap-3 justify-center">
                        <!-- 인벤토리 아이템이 여기에 동적으로 추가됩니다 -->
                    </div>
                </div>
            </div>
        </main>
    </div>

    <div id="sidebar-overlay" class="fixed inset-0 bg-black bg-opacity-60 z-20 hidden"></div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- 데이터 정의 ---
            const equippableTypes = ['weapon', 'belt', 'ring', 'armor', 'gloves', 'pants', 'boots', 'shield', 'pet'];
            const allItems = {
                101: { name: '견습 마법사의 스태프', type: 'weapon', icon: 'https://placehold.co/64x64/a78bfa/1e1b4b?text=W' },
                102: { name: '가죽 벨트', type: 'belt', icon: 'https://placehold.co/64x64/a16207/fefce8?text=B' },
                103: { name: '힘의 반지', type: 'ring', icon: 'https://placehold.co/64x64/facc15/422006?text=R' },
                201: { name: '가죽 갑옷', type: 'armor', icon: 'https://placehold.co/64x64/78350f/fef3c7?text=A' },
                202: { name: '가죽 장갑', type: 'gloves', icon: 'https://placehold.co/64x64/78350f/fef3c7?text=G' },
                203: { name: '가죽 바지', type: 'pants', icon: 'https://placehold.co/64x64/78350f/fef3c7?text=P' },
                204: { name: '가죽 부츠', type: 'boots', icon: 'https://placehold.co/64x64/78350f/fef3c7?text=S' },
                301: { name: '나무 방패', type: 'shield', icon: 'https://placehold.co/64x64/57534e/e7e5e4?text=S' },
                401: { name: '아기 늑대', type: 'pet', icon: 'https://placehold.co/64x64/6b7280/e5e7eb?text=Pet' },
                501: { name: '체력 포션', type: 'consumable', icon: 'https://placehold.co/64x64/ef4444/fee2e2?text=HP' },
                502: { name: '질긴 가죽', type: 'material', icon: 'https://placehold.co/64x64/7c2d12/fef3c7?text=L' },
                503: { name: '철광석', type: 'material', icon: 'https://placehold.co/64x64/52525b/e4e4e7?text=Fe' },
                504: { name: '마나 포션', type: 'consumable', icon: 'https://placehold.co/64x64/6366f1/e0e7ff?text=MP' },
            };

            const inventoryItems = [ 101, 102, 103, 501, 201, 202, 502, 203, 204, 301, 503, 401, 504 ];
            let equippedItems = { weapon: null, belt: null, ring1: null, ring2: null, pet: null, shield: null, armor: null, gloves: null, pants: null, boots: null };
            let selectedItemId = null;

            // --- DOM 요소 ---
            const inventoryGrid = document.getElementById('inventory-grid');
            const equipmentSlots = document.querySelectorAll('.equipment-slot');

            // --- 렌더링 함수 ---
            function renderInventory() {
                inventoryGrid.innerHTML = '';
                inventoryItems.forEach(itemId => {
                    const itemData = allItems[itemId];
                    if (!itemData) return;
                    
                    const isEquipped = Object.values(equippedItems).includes(itemId);
                    const isEquippable = equippableTypes.includes(itemData.type);

                    const itemEl = document.createElement('div');
                    itemEl.dataset.id = itemId;
                    let classNames = 'inventory-item flex items-center justify-center';
                    if(isEquipped) classNames += ' equipped';
                    if(!isEquippable) classNames += ' non-equip';
                    itemEl.className = classNames;

                    itemEl.draggable = isEquippable && !isEquipped;
                    
                    itemEl.innerHTML = `<img src="${itemData.icon}" alt="${itemData.name}" class="w-14 h-14">`;
                    inventoryGrid.appendChild(itemEl);
                });
            }

            function renderEquipment() {
                equipmentSlots.forEach(slot => {
                    const slotName = slot.dataset.slot;
                    const itemId = equippedItems[slotName];
                    slot.innerHTML = '';
                    if (itemId) {
                        const itemData = allItems[itemId];
                        slot.innerHTML = `<div class="inventory-item !border-indigo-500" data-id="${itemId}" draggable="true"><img src="${itemData.icon}" alt="${itemData.name}" class="w-14 h-14"></div>`;
                        slot.classList.remove('border-dashed', 'border-gray-600');
                    } else {
                        slot.classList.add('border-dashed', 'border-gray-600');
                    }
                });
            }

            // --- 상호작용 로직 ---
            function equipItem(itemId, slotName) {
                const itemData = allItems[itemId];
                if (itemData.type !== 'ring') {
                    for(const [key, value] of Object.entries(equippedItems)) {
                        if (value === itemId) equippedItems[key] = null;
                    }
                }
                equippedItems[slotName] = itemId;
                selectedItemId = null;
                renderAll();
            }
            
            function unequipItem(slotName) {
                equippedItems[slotName] = null;
                renderAll();
            }

            function isCompatible(itemType, slotName) {
                if (itemType === 'ring' && (slotName === 'ring1' || slotName === 'ring2')) return true;
                return itemType === slotName;
            }

            // --- 이벤트 핸들러 ---
            function setupEventListeners() {
                inventoryGrid.addEventListener('click', e => {
                    const itemEl = e.target.closest('.inventory-item');
                    if (!itemEl || itemEl.classList.contains('equipped') || itemEl.classList.contains('non-equip')) return;

                    document.querySelectorAll('.inventory-item.selected').forEach(el => el.classList.remove('selected'));
                    itemEl.classList.add('selected');
                    selectedItemId = parseInt(itemEl.dataset.id);
                });

                equipmentSlots.forEach(slot => {
                    slot.addEventListener('click', () => {
                        const slotName = slot.dataset.slot;
                        const equippedItemId = equippedItems[slotName];

                        if (equippedItemId) {
                             unequipItem(slotName);
                        } 
                        else if (selectedItemId) {
                            const itemData = allItems[selectedItemId];
                            if (isCompatible(itemData.type, slotName)) {
                                equipItem(selectedItemId, slotName);
                            }
                        }
                    });

                    slot.addEventListener('dragover', e => e.preventDefault());
                    slot.addEventListener('drop', e => {
                        e.preventDefault();
                        const draggedItemId = parseInt(e.dataTransfer.getData('text/plain'));
                        const itemData = allItems[draggedItemId];
                        if (isCompatible(itemData.type, slot.dataset.slot)) {
                            equipItem(draggedItemId, slot.dataset.slot);
                        }
                    });
                });
                
                document.getElementById('equipment-container').addEventListener('dragstart', e => {
                    const itemEl = e.target.closest('.inventory-item');
                    if(itemEl){
                       e.dataTransfer.setData('text/plain', itemEl.dataset.id);
                       const slot = itemEl.closest('.equipment-slot');
                       if(slot) unequipItem(slot.dataset.slot);
                    }
                });
            }

            function renderAll() {
                renderInventory();
                renderEquipment();
            }

            // --- 사이드바 및 초기화 ---
            const sidebar = document.getElementById('sidebar'), mainContent = document.getElementById('main-content'),
                  sidebarToggleBtn = document.getElementById('sidebar-toggle-btn'), sidebarOverlay = document.getElementById('sidebar-overlay');
            function applySidebarState(isOpen) { const isDesktop = window.innerWidth >= 768; if (isOpen) { sidebar.classList.remove('-translate-x-full'); sidebarOverlay.classList.remove('hidden'); if (isDesktop) { mainContent.classList.add('md:ml-64'); sidebarOverlay.classList.add('hidden'); } } else { sidebar.classList.add('-translate-x-full'); sidebarOverlay.classList.add('hidden'); if (isDesktop) { mainContent.classList.remove('md:ml-64'); } } }
            function toggleSidebar() { applySidebarState(!sidebar.classList.contains('-translate-x-full')); }
            function initializeSidebar() { applySidebarState(window.innerWidth >= 768); }
            sidebarToggleBtn.addEventListener('click', toggleSidebar);
            sidebarOverlay.addEventListener('click', toggleSidebar);
            window.addEventListener('resize', initializeSidebar);
            
            initializeSidebar();
            renderAll();
            setupEventListeners();
        });
    </script>
</body>
</html>
