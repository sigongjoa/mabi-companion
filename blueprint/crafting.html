<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>마비노기 - 가공 시설</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #111827;
            color: #d1d5db;
        }
        .sidebar-link.active {
            background-color: #4f46e5;
            color: #ffffff;
            font-weight: 700;
        }
        .processing-queue {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background-color: #374151;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 3px solid #4b5563;
        }
         .processing-queue.processing {
            border-color: #a5b4fc;
         }
        .progress-circle {
            transition: background 0.5s;
        }
        .item-card {
            background-color: #374151;
            border-radius: 0.5rem;
            padding: 0.75rem;
            text-align: center;
        }
    </style>
</head>
<body class="text-gray-800">

    <div class="relative min-h-screen flex">
        <!-- 사이드바 네비게이션 -->
        <aside id="sidebar" class="w-64 bg-gray-900 text-white shadow-lg h-screen fixed top-0 left-0 transform transition-transform duration-300 ease-in-out z-30">
            <div class="p-5 border-b border-gray-700 flex items-center space-x-3">
                 <div class="w-10 h-10 rounded-lg bg-indigo-600 flex items-center justify-center">
                    <svg class="w-6 h-6 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25" /></svg>
                 </div>
                 <div>
                    <h2 class="text-lg font-bold">마비노기</h2>
                    <p class="text-xs text-gray-400">제작 계산기</p>
                 </div>
            </div>
            <nav class="mt-4">
                <ul>
                    <li><a href="#" class="sidebar-link active flex items-center py-3 px-5">
                        <svg class="w-6 h-6 mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M11.25 4.5l7.5 7.5-7.5 7.5m-6-15l7.5 7.5-7.5 7.5" /></svg>
                        가공 시설
                    </a></li>
                    <li><a href="#" class="sidebar-link flex items-center py-3 px-5 text-gray-300 hover:bg-gray-800 transition-colors">
                        <svg class="w-6 h-6 mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 3v11.25A2.25 2.25 0 006 16.5h2.25M3.75 3h-1.5m1.5 0h16.5m-16.5 0H6.75m0 0h11.25m-11.25 0H6.75m0 0v11.25m0 0H6.75m0 0h11.25m0 0h1.5m-1.5 0v-1.5m0 0V3m0 0h-1.5m1.5 0H1.5m15 0h1.5" /></svg>
                        던전 정보
                    </a></li>
                    <!-- Other links... -->
                </ul>
            </nav>
        </aside>

        <!-- 메인 콘텐츠 -->
        <main id="main-content" class="flex-1 transition-all duration-300 ease-in-out">
            <header class="bg-gray-900 shadow-sm p-4 flex items-center sticky top-0 z-20">
                <button id="sidebar-toggle-btn" class="p-2 mr-4 text-gray-400 hover:text-white">
                    <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" /></svg>
                </button>
                <div class="text-sm text-gray-400"><span>홈</span><span class="mx-1">/</span><span>가공 시설</span></div>
            </header>
            
            <div id="content-wrapper" class="p-4 md:p-8">
                <h1 class="text-3xl font-bold text-white mb-2">가공 시설</h1>
                <p class="text-gray-400 mb-8">원재료를 상위 아이템으로 가공하고 남은 시간을 확인하세요.</p>

                <div id="facility-container" class="space-y-8">
                    <!-- 가공 시설 카드가 여기에 동적으로 추가됩니다 -->
                </div>
            </div>
        </main>
    </div>

    <div id="sidebar-overlay" class="fixed inset-0 bg-black bg-opacity-60 z-20 hidden"></div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const facilitiesData = [
                { id: 'metal', name: '금속 가공 시설', level: 4, image: 'https://placehold.co/150x150/1f2937/4b5563?text=용광로', items: [ { name: '철괴(광석)', icon: 'https://placehold.co/64x64/60a5fa/1e3a8a?text=철' }, { name: '강철괴', icon: 'https://placehold.co/64x64/9ca3af/1f2937?text=강' }, { name: '합금괴', icon: 'https://placehold.co/64x64/f87171/450a0a?text=합' } ] },
                { id: 'wood', name: '목재 가공 시설', level: 3, image: 'https://placehold.co/150x150/1f2937/4b5563?text=제재기', items: [ { name: '목재', icon: 'https://placehold.co/64x64/a16207/422006?text=목' }, { name: '상급 목재', icon: 'https://placehold.co/64x64/ca8a04/422006?text=상' }, { name: '부드러운 목재', icon: 'https://placehold.co/64x64/dcfce7/14532d?text=부' } ] },
                { id: 'leather', name: '가죽 가공', level: 3, image: 'https://placehold.co/150x150/1f2937/4b5563?text=무두질틀', items: [ { name: '가죽', icon: 'https://placehold.co/64x64/a16207/422006?text=가' }, { name: '상급 가죽', icon: 'https://placehold.co/64x64/ca8a04/422006?text=상' } ] },
                { id: 'fabric', name: '옷감 가공', level: 3, image: 'https://placehold.co/150x150/1f2937/4b5563?text=베틀', items: [ { name: '옷감', icon: 'https://placehold.co/64x64/e5e7eb/374151?text=옷' }, { name: '실크', icon: 'https://placehold.co/64x64/f3f4f6/374151?text=실' }, { name: '상급 옷감', icon: 'https://placehold.co/64x64/d1d5db/374151?text=상' } ] },
                { id: 'potion', name: '약품 가공', level: 3, image: 'https://placehold.co/150x150/1f2937/4b5563?text=증류기', items: [ { name: '새벽 버섯 진액', icon: 'https://placehold.co/64x64/a78bfa/3730a3?text=진' }, { name: '튼튼 버섯 가루', icon: 'https://placehold.co/64x64/fcd34d/b45309?text=가' }, { name: '불꽃의 결정', icon: 'https://placehold.co/64x64/f87171/7f1d1d?text=결' } ] },
                { id: 'food', name: '식재료 가공', level: 3, image: 'https://placehold.co/150x150/1f2937/4b5563?text=맷돌', items: [ { name: '마요네즈', icon: 'https://placehold.co/64x64/fef08a/a16207?text=마' }, { name: '밀가루', icon: 'https://placehold.co/64x64/fde68a/a16207?text=밀' }, { name: '치즈', icon: 'https://placehold.co/64x64/fcd34d/b45309?text=치' }, { name: '면', icon: 'https://placehold.co/64x64/fbbf24/b45309?text=면' }, { name: '생크림', icon: 'https://placehold.co/64x64/f9fafb/374151?text=생' } ] },
            ];

            const facilityContainer = document.getElementById('facility-container');

            function createFacilityCard(facility) {
                const card = document.createElement('div');
                card.id = `facility-${facility.id}`;
                card.className = 'bg-gray-800 rounded-lg p-6';
                card.innerHTML = `
                    <div class="flex flex-col md:flex-row gap-6">
                        <!-- 좌측: 시설 정보 및 큐 -->
                        <div class="flex-shrink-0 md:w-1/3 text-center md:text-left">
                            <h2 class="text-xl font-bold text-white">${facility.name} Lv. ${facility.level}</h2>
                             <img src="${facility.image}" alt="${facility.name}" class="w-40 h-40 mx-auto md:mx-0 my-4 rounded-lg">
                             <button class="claim-all-btn bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg w-full mb-4">모두 받기</button>
                             <div class="flex justify-center md:justify-start space-x-2">
                                 ${Array(4).fill(0).map((_, i) => `<div class="processing-queue" data-queue-id="${i}"><span class="text-gray-400 text-sm">대기</span></div>`).join('')}
                             </div>
                        </div>
                        <!-- 우측: 제작 아이템 목록 -->
                        <div class="flex-1">
                            <h3 class="text-lg font-semibold text-white mb-4">제작 가능 아이템</h3>
                            <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4">
                                ${facility.items.map(item => `
                                    <div class="item-card">
                                        <img src="${item.icon}" class="w-16 h-16 rounded-md mx-auto">
                                        <p class="text-sm mt-2 font-semibold">${item.name}</p>
                                        <input type="number" class="item-quantity-input w-full bg-gray-600 rounded-md p-1 mt-2 text-center" placeholder="수량" min="1">
                                        <button class="process-btn w-full bg-indigo-500 hover:bg-indigo-600 text-white text-sm font-bold py-1 mt-2 rounded-md">제작</button>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `;
                facilityContainer.appendChild(card);
            }

            const timers = {};

            function startProcessing(facilityId, queueEl, quantity) {
                if (queueEl.classList.contains('processing')) return false; // 이미 사용 중인 큐

                queueEl.classList.add('processing');
                let duration = quantity * 5; // 1개당 5초로 가정
                let remaining = duration;

                queueEl.innerHTML = `<div class="progress-circle" style="background: conic-gradient(#4ade80 0deg, #374151 0deg); width:100%; height:100%; border-radius:50%; display:flex; align-items:center; justify-content:center;">
                    <span class="timer-text font-bold text-lg">${remaining}</span>
                </div>`;
                
                const progressCircle = queueEl.querySelector('.progress-circle');
                const timerText = queueEl.querySelector('.timer-text');
                
                timers[`${facilityId}-${queueEl.dataset.queueId}`] = setInterval(() => {
                    remaining--;
                    const angle = ((duration - remaining) / duration) * 360;
                    progressCircle.style.background = `conic-gradient(#4ade80 ${angle}deg, #374151 ${angle}deg)`;
                    timerText.textContent = remaining;

                    if (remaining <= 0) {
                        clearInterval(timers[`${facilityId}-${queueEl.dataset.queueId}`]);
                        queueEl.classList.remove('processing');
                         queueEl.classList.add('bg-green-500', 'cursor-pointer');
                         queueEl.innerHTML = `<span class="font-bold">받기</span>`;
                    }
                }, 1000);
                 return true;
            }

            function setupEventListeners() {
                facilityContainer.addEventListener('click', e => {
                    if (e.target.matches('.process-btn')) {
                        const card = e.target.closest('.item-card');
                        const quantityInput = card.querySelector('.item-quantity-input');
                        const quantity = parseInt(quantityInput.value) || 1;
                        const facilityCard = e.target.closest('.bg-gray-800');
                        const facilityId = facilityCard.id.split('-')[1];
                        
                        const availableQueue = facilityCard.querySelector('.processing-queue:not(.processing):not(.bg-green-500)');
                        if (availableQueue) {
                            startProcessing(facilityId, availableQueue, quantity);
                        } else {
                            alert('모든 가공 슬롯이 사용 중입니다.');
                        }
                    }
                    if (e.target.matches('.claim-all-btn')) {
                        const facilityCard = e.target.closest('.bg-gray-800');
                        facilityCard.querySelectorAll('.processing-queue.bg-green-500').forEach(q => {
                            q.classList.remove('bg-green-500', 'cursor-pointer');
                            q.innerHTML = '<span class="text-gray-400 text-sm">대기</span>';
                        });
                    }
                    if(e.target.matches('.processing-queue.bg-green-500') || e.target.parentElement.matches('.processing-queue.bg-green-500')) {
                        const queueEl = e.target.closest('.processing-queue');
                        queueEl.classList.remove('bg-green-500', 'cursor-pointer');
                        queueEl.innerHTML = '<span class="text-gray-400 text-sm">대기</span>';
                    }
                });
            }

            // --- 사이드바 및 초기화 ---
            const sidebar = document.getElementById('sidebar'), mainContent = document.getElementById('main-content'),
                  sidebarToggleBtn = document.getElementById('sidebar-toggle-btn'), sidebarOverlay = document.getElementById('sidebar-overlay');
            function applySidebarState(isOpen) { const isDesktop = window.innerWidth >= 768; if (isOpen) { sidebar.classList.remove('-translate-x-full'); sidebarOverlay.classList.remove('hidden'); if (isDesktop) { mainContent.classList.add('md:ml-64'); sidebarOverlay.classList.add('hidden'); } } else { sidebar.classList.add('-translate-x-full'); sidebarOverlay.classList.add('hidden'); if (isDesktop) { mainContent.classList.remove('md:ml-64'); } } }
            function toggleSidebar() { applySidebarState(!sidebar.classList.contains('-translate-x-full')); }
            function initializeSidebar() { applySidebarState(window.innerWidth >= 768); }
            sidebarToggleBtn.addEventListener('click', toggleSidebar);
            sidebarOverlay.addEventListener('click', toggleSidebar);
            window.addEventListener('resize', initializeSidebar);
            
            initializeSidebar();
            facilitiesData.forEach(createFacilityCard);
            setupEventListeners();
        });
    </script>
</body>
</html>
